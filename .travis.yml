language: cpp

addons:
  apt:
    packages:
      - libfreetype6-dev
      - libx11-dev
      - libxrandr-dev
      - libgl1-mesa-dev
      - libudev-dev
      - libopenal-dev
      - libflac-dev
      - libogg-dev
      - libvorbis-dev

matrix:
  include:

    - name: linux-gcc-dynamic
      os: linux
      dist: xenial
      compiler: gcc

    - name: macos-clang-dynamic
      os: osx
      compiler: clang
      env:
        - CMAKE_FLAGS="-DSFML_DEPENDENCIES_INSTALL_PREFIX=../SFML-install"

before_script:
  - git -C $HOME/SFML pull || git clone https://github.com/SFML/SFML.git $HOME/SFML
  - mkdir -p SFML-build && mkdir -p SFML-install && cd SFML-build
  - cmake $HOME/SFML $CMAKE_FLAGS -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=../SFML-install
  - cmake --build . --target install
  - cd ..

script:
  - mkdir build && cd build
  - cmake -DSFML_DIR=$TRAVIS_BUILD_DIR/SFML-install/lib/cmake/SFML ..
  - cmake --build .
  - cd ..

cache:
  directories:
    - SFML-build
    - SFML-install
    - "$HOME/SFML"

before_deploy:
  - git clone https://github.com/SamuelGallay/BrownianMotion.git --branch gh-pages --single-branch gh-pages
  - zip -r gh-pages/$TRAVIS_JOB_NAME.zip SFML-build

deploy:
  provider: pages
  local_dir: gh-pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN
  on:
    branch: master
